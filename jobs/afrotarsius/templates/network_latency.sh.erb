#!/bin/bash

PIDFILE=$RUN_DIR/afrotarsius.pid
LOG_DIR=/var/vcap/sys/log/afrotarsius

mkdir -p $LOG_DIR

case $1 in

  start)
    tc qdisc add dev eth0 root netem delay 1000ms 500ms &>> $LOG_DIR/afrotarsius.log

    until [ `tc qdisc show dev eth0 | grep netem | wc -l` -eq 0 ]; && sleep 10; done &

    echo $! > $PIDFILE
    ;;

  stop)
    tc qdisc delete dev eth0 root netem delay 1000ms 500ms &>> $LOG_DIR/afrotarsius.log
    ;;

  *)
    echo "Usage: network_latency.sh {start|stop}"

    ;;

esac
